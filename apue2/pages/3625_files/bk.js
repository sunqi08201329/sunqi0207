bkuc={};bkuc.user={};baidu.extend(bkuc.user,{getUserAvatar:function(B,A){if(B<0||A<0){return"http://img.baidu.com/img/baike/blank.gif";}var _={1:"http://img.baidu.com/img/baike/encourage/user-priority-boy.gif",2:"http://img.baidu.com/img/baike/encourage/user-priority-girl.gif",3:"http://img.baidu.com/img/baike/encourage/5year-boy.png",4:"http://img.baidu.com/img/baike/encourage/5year-girl.png"};if(0==B){return"http://img.baidu.com/img/baike/pictures/r0s1g"+A+".gif";}else{if(B>0&&B<5){return _[B];}else{return"/cms/s/usershow/"+B+".jpg";}}}});bkuc.url={};baidu.extend(bkuc.url,{removeHash:function(){if(location.hash.length>0){if(history.pushState){history.pushState("",document.title,location.pathname);}else{location.hash="_";}}}});bkuc.dom={};baidu.extend(bkuc.dom,{preventScroll:function(_){_=baidu.g(_);if(baidu.browser.firefox){_.addEventListener("DOMMouseScroll",function(A){_.scrollTop+=A.detail>0?30:-30;A.preventDefault();},false);}else{_.onmousewheel=function(A){A=A||window.event;_.scrollTop+=A.wheelDelta>0?-30:30;A.returnValue=false;};}},placeholder:function(_,B){var A=document.createElement("input");if(A.placeholder===undefined){B=B||"#999";var F=baidu.g(_),E=F.getAttribute("placeholder");if(!E){return;}var D=baidu.dom.getStyle(F,"color"),C=function(){var _=F.value;if(""==_||E==_){F.value=E;baidu.dom.setStyle(F,"color",B);}};baidu.on(F,"focus",function(){var _=F.value;if(""==_||E==_){F.value="";baidu.dom.setStyle(F,"color",D);}});baidu.on(F,"blur",C);C();}}});bkuc.event=(function(){var A={visibilityChange:function(_,A){if(document.visibilityState){return k;}else{if(document.msVisibilityState){return A[0];}else{if(document.webkitVisibilityState){return A[1];}}}return null;}},_={visibilitychange:["msvisibilitychange","webkitvisibilitychange",null,null,A.visibilityChange]};return baidu.extend({},{specialEvents:_});}());baidu.extend(bkuc.event,{on:function(D,C,B){if(bkuc.event.specialEvents.hasOwnProperty(C)){var _=bkuc.event.specialEvents[C],A=_[4];C=A(C,_);if(C!=null){baidu.on(D,C,B);}return;}baidu.on(D,C,B);},un:function(D,C,B){if(bkuc.event.specialEvents.hasOwnProperty(C)){var _=bkuc.event.specialEvents[C],A=_[4];C=A(C,_);if(C!=null){baidu.un(D,C,B);}return;}baidu.un(D,C,B);},isEventSupported:(function(){var A={select:"input",change:"input",submit:"form",reset:"form",error:"img",load:"img",abort:"img"};function _(C,B){B=B||document.createElement(A[C]||"div");C="on"+C;var _=(B.eventName!==undefined);if(!_){if(!B.setAttribute){B=document.createElement("div");}if(B.setAttribute&&B.removeAttribute){B.setAttribute(C,"");_=typeof B[C]=="function";if(typeof B[C]!="undefined"){B[C]=undefined;}B.removeAttribute(C);}}B=null;return _;}return _;}())});bkuc.setDomain=function(){try{var _=document.referrer||"",B=document.referrer.indexOf("://passport.baidu.com")!==-1;B=B||(top.location.href.indexOf("://passport.baidu.com")!==-1);if(B){document.domain="baidu.com";}}catch(A){document.domain="baidu.com";}};if(typeof bk=="undefined"){bk={};}if(typeof bk.ui=="undefined"){bk.ui={};}bk.ui.enctip=function(){this.type=1;this.msg_url="/user/ajax/checknotice?entry="+this.type+"&r="+Math.random();this.has_login=true;this.id="encourage_tip_wrapper";this.cookie_name="bk_encourage_tip2";this.cookie_interval=1800000;};bk.ui.enctip.prototype={render:function(B){var C=document.createDocumentFragment(),A=document.createElement("div");A.id=this.id;A.className="enc-tip";A.innerHTML='<div class="ctr"><div class="tri out"></div><div class="tri in"></div></div><div class="enc-wrap">'+'<div class="enc-content fix clearfix"><div class="fl"><a href="'+B.href+'" target="_blank" '+"onclick=\"nslog('"+window.location.href+'\', 434)"><img id="encTipIcon" /></a></div><div class="fr">'+'<h3><a href="'+B.href+'" target="_blank" onclick="nslog(\''+window.location.href+"', 434)\">"+B.title+'</a></h3><div class="enc-txt" id="encourage_body">'+B.text+'</div></div></div></div><a href="javascript:void(0)" class="close" title="\u5173\u95ed" '+"onclick=\"var tipWrapper = baidu.g('encourage_tip_wrapper');tipWrapper.parentNode.removeChild(tipWrapper);nslog('"+window.location.href+"',442);\">\u5173\u95ed</a>";C.appendChild(A);document.body.appendChild(C);var _=baidu.g("encTipIcon");_.onload=function(){var C=baidu.browser.ie?262:264,B=baidu.dom.query(".enc-content .fl")[0].offsetWidth;baidu.dom.setStyle(baidu.dom.query(".enc-content .fr")[0],"width",(C-B));baidu.q("enc-content",A.id,"div")[0].style.zoom="1";baidu.g(A.id).style.visibility="visible";_.onload=null;var D=baidu.dom.getPosition(baidu.q("myhome",document.body,"li")[0]).left,F=baidu.dom.getPosition(A.id).left,E=D-F+20;baidu.q("ctr",A.id,"div")[0].style.left=E+"px";};_.src=B.url;bk.ui.enctip.set_nslog_area_type("encourage_body",435);},close:function(){var _=baidu.g("encourage_tip_wrapper");if(_){_.parentNode.removeChild(_);}},init:function(){var A=false;if(this.has_login){var _=baidu.cookie.get(this.cookie_name);if(!_){A=true;baidu.cookie.set(this.cookie_name,baidu.url.jsonToQuery({show:A}),{expires:this.cookie_interval});}}if(A){this.get_content();}},get_content:function(){var _=this;baidu.ajax.get(this.msg_url,function(C){var A=bk.ui.enctip.format_result(baidu.json.parse(C.responseText),_.type),B=!baidu.object.isEmpty(A);if(B){_.render(A);}});}};bk.ui.enctip.format_result=function(A,_){var C={},B=A.length;if(B==0){return C;}switch(_){case 0:case 1:C.href=A[0].iconHref;C.url=A[0].iconUrl;C.title=A[0].title;C.text=A[0].text;return C;case 2:C.href=A[0].iconHref;C.url=A[0].iconUrl;C.banner_href=A[0].bannerHref;C.banner_url=A[0].bannerBigUrl;C.title=A[0].title;C.text=[];break;case 3:C.href=A[0].iconHref;C.title=A[0].title;C.text=[];break;case 4:C.banner_href=A[0].bannerHref;C.banner_url=A[0].bannerUrl;C.text=A[0].text;return C;}if(B>0){var D;for(D=0;D<B;++D){C.text.push(A[D].text);}}return C;};bk.ui.enctip.build_tip_generic=function(_,A){var D=function(_){return A.call(null,_);},B=_,C="/user/ajax/checknotice?entry="+B+"&r="+Math.random();baidu.ajax.get(C,function(C){var A=baidu.json.parse(C.responseText);if(A.length>0){var _=bk.ui.enctip.format_result(A,B);D(_);}});};bk.ui.enctip.set_nslog_area_type=function(A,B){var _=(typeof A==="string")?baidu.g(A):A;baidu.each(_.getElementsByTagName("a"),function(_){_.target="_blank";_.className="nslog:"+B;});};bk.ui.enctip.build_edit_tip=function(){var _=function(_){var A='<div id="encourage_tipbar"><div class="push-close-btn" alt="\u5173\u95ed" title="\u5173\u95ed" onclick="nslog(\''+window.location.href+"', 443);var msg_pb = document.getElementById('encourage_tipbar');msg_pb.parentNode.removeChild(msg_pb);msg_pb=null\"></div>"+'<div><a class="icon-address" id="encourage_icon_href" href="'+_.href+'" target="_blank"><img id="encourage_icon_url" src="'+_.url+'" alt="\u6253\u5f00\u94fe\u63a5" title="\u6253\u5f00\u94fe\u63a5"  /></a><span id="encourage_text">'+_.text+"</span></div></div>";if(baidu.g("enctip")){baidu.g("enctip").innerHTML=A;return;}if(baidu.g("inputShowMainInfoBoxDiv")){baidu.dom.insertHTML("guidebar","beforeBegin",A);bk.ui.enctip.set_nslog_area_type("encourage_text",436);}};bk.ui.enctip.build_tip_generic(0,_);};bk.ui.enctip.build_usercenter_tip=function(){var _=function(A){var C=A.text.length,_=[],E;for(E=0;E<C;++E){_.push("<li><span>");_.push(A.text[E]);_.push("</span></li>");}var D=window.location.href,B='<div class="push-ads" id="push_ads"><a id="banner_href" href="'+A.banner_href+'" class="icon-address" target="_blank" onclick="nslog(\''+A.banner_href+'\',437)"><img id="banner_url" src="'+A.banner_url+'" alt="\u6253\u5f00\u94fe\u63a5" title="\u6253\u5f00\u94fe\u63a5" width="778px" height="100px"/></a><a class="del" '+"onclick=\"nslog('"+D+"', 444);var del = document.getElementById('push_ads');del.parentNode.removeChild(del);del=null\" title=\"\u5173\u95ed\"></a></div>"+'<dl class="mod-push" id="enc_push_bar"><dt><p><a id="encourage_icon_href" href="'+A.href+'" class="icon-address" target="_blank"><img id="encourage_icon_url" src="'+A.url+'" alt="\u6253\u5f00\u94fe\u63a5" title="\u6253\u5f00\u94fe\u63a5" /></a>'+'<span id="encourage_title">'+A.title+'</span></p><div class="del" onclick="nslog(\''+D+"', 445);var del = document.getElementById('enc_push_bar');del.parentNode.removeChild(del);del=null\" title=\"\u5173\u95ed\"></div></dt>"+'<dd><ul id="encouragements">'+_.join("")+"</ul></dd></dl>";baidu.dom.insertHTML("col_main","afterBegin",B);bk.ui.enctip.set_nslog_area_type("encouragements",438);};bk.ui.enctip.build_tip_generic(2,_);};bk.ui.enctip.build_userinfo_tip=function(){var A=baidu.g("encourage");if(!A){return;}var _=function(D){baidu.g("encourage_icon_href").href=D.href;var C=baidu.g("encourage_title");C.href=D.href;C.innerHTML=D.title;var E=D.text.length,B=[],F;for(F=0;F<E;++F){B.push("<li><span>");B.push(D.text[F]);B.push("</span></li>");}var _=baidu.g("encouragements");_.innerHTML=B.join("");baidu.removeClass(A,"dnone");baidu.removeClass(A.parentNode,"dnone");bk.ui.enctip.set_nslog_area_type(_,439);};bk.ui.enctip.build_tip_generic(3,_);};bk.ui.enctip.buildEditSuccessTip=function(){var _=function(_){var A='<a href="'+_.banner_href+'" onclick="nslog(\''+_.banner_href+'\',440)" target="_blank">'+'<img width="450px" height="60px" src="'+_.banner_url+'" /></a>',C=baidu.g("encourage_tip");C.innerHTML=A;C.style.display="block";var B=baidu.g("encourage_text");B.innerHTML=_.text;B.style.display="block";};bk.ui.enctip.build_tip_generic(4,_);};baidu.more.ns("bk.usercenter");bk.usercenter.progressbar=function(_){this.options=_||{};};baidu.extend(bk.usercenter.progressbar.prototype,{build:function(){baidu.g(this.options.selector).innerHTML=this.html();},init:function(_){if(_){this.options=baidu.extend(this.options||{},_);}this.build();},html:function(){var _=[];_.push('<div class="progress-bar">');_.push('<div class="process-inner fix"><span class="pl"></span>');var A=this.calculateProgress();if(A>0){_.push('<span class="pb" style="width:'+A+'px"></span>');}_.push('<span class="pr"></span></div>');_.push('<div class="process-text" style="'+(this.options.textStyle||"")+'">'+this.options.text+"</div>");_.push("</div>");return _.join("");},calculateProgress:function(){var A=this.options.maxWidth,B=A/100,_=(this.options.process||0)*100*B;_=(_>A?A:_);this.options.pixelProgress=_;return _;}});bk.usercenter.commonTaskProgressbar=function(_){bk.usercenter.progressbar.call(this,_);baidu.extend(this.options,{txtStart:-16});};baidu.lang.inherits(bk.usercenter.commonTaskProgressbar,bk.usercenter.progressbar);baidu.extend(bk.usercenter.commonTaskProgressbar.prototype,{init:function(){bk.usercenter.progressbar.prototype.init.call(this);var _=this.options.pixelProgress+this.options.txtStart,A=baidu.dom.q("process-text",this.options.selector,"div")[0];if(A){A.style.left=_+"px";}}});baidu.extend(bk.usercenter.progressbar,{init:function(C){var B=C.type.toLowerCase()||"simple",_=bk.usercenter.progressbar.barConfigs[B];C.maxWidth=_.maxWidth;var A=new _.ctr(C);A.init();},barConfigs:{simple:{ctr:bk.usercenter.progressbar,maxWidth:120},common:{ctr:bk.usercenter.commonTaskProgressbar,maxWidth:140}}});baidu.more.ns("bk.floatBottle");(function(){bk.floatBottle.bottle=function(_){baidu.extend(this,_);this.refuse=null;this.replyList=[];};baidu.extend(bk.floatBottle,{BOTTLE_TYPE:{CARD:1,SUMMARY:2,BODY:3},ACT_STATUS:{NEW:1,BEFORE_EDIT:2,AFTER_EDIT:3,END:4},ACTION:{THROW:"throw",GAIN:"gain",RETHROW:"rethrow"},STATUS:{THROW:{UNSOLVED:1,UNCOMMENT:2,SOLVED:3,FAIL:7},GAIN:{UNEDIT:4,EDITING:5,SUCCESS:6,FAIL:7,COMPLAINT:8}},REQ_URLS:{BOTTLE_CHECK_URL:"/user/ajax/bottle/throw?",BOTTLE_OPEN_URL:"/user/ajax/bottle/show?"},REPLACE:function(_){return _;},GET_BOTTLE_STATUS:function(_,A){switch(A){case bk.floatBottle.ACTION.THROW:switch(_){case 1:case 2:case 3:case 12:return bk.floatBottle.STATUS.THROW.UNSOLVED;case 4:case 5:return bk.floatBottle.STATUS.THROW.UNCOMMENT;case 6:case 7:case 8:case 9:return bk.floatBottle.STATUS.THROW.SOLVED;case 11:case 13:return bk.floatBottle.STATUS.THROW.FAIL;}break;case bk.floatBottle.ACTION.GAIN:switch(_){case 1:case 2:return bk.floatBottle.STATUS.GAIN.UNEDIT;case 3:case 4:case 5:return bk.floatBottle.STATUS.GAIN.EDITING;case 6:case 7:case 11:return bk.floatBottle.STATUS.GAIN.SUCCESS;case 8:case 9:case 13:return bk.floatBottle.STATUS.GAIN.FAIL;case 12:return bk.floatBottle.STATUS.GAIN.COMPLAINT;}break;}},GET_BOTTLE_CONT:function(_){switch(parseInt(_,10)){case 1:return bk.floatBottle.cardBottle;default:return bk.floatBottle.bottle;}}});baidu.lang.inherits(bk.floatBottle.bottle,baidu.lang.Class);baidu.extend(bk.floatBottle.bottle.prototype,{isEmpty:function(){return false;},parseReply:function(){return null;},getReplyList:function(){},check:function(){},open:function(_){var A=this;bk.usercenter.ajax.post(bk.floatBottle.REQ_URLS.BOTTLE_OPEN_URL,baidu.url.jsonToQuery({bottleId:A.id}),function(E){if(E.responseText){var C=baidu.json.parse(E.responseText),D=C.bottle,G=bk.floatBottle.tools.parseRdBottle2My(D);A.replyList=[];var B=false;baidu.each(C.reply,function(_){!B&&A.replyList.push(A.parseReply(_,G));if(_.type=="11"){B=true;}});var H=new bk.floatBottle.reply({id:0,from:G.thrower,tag:D.content,bottle:G,isOpen:true,type:0,status:G.status});A.replyList.push(H);var F={bottle:G,reply:A.replyList};A.dispatchEvent("onOpen",F);_.dispatchEvent("onBottleOpen",F);}});},getThrowData:function(){return null;},getRefuseData:function(){return null;}});}());(function(){bk.floatBottle.cardBottle=function(_){bk.floatBottle.bottle.call(this,_);this.type=bk.floatBottle.BOTTLE_TYPE.CARD;this.lemma=this.lemmas?this.lemmas[0]:_.lemma;};baidu.lang.inherits(bk.floatBottle.cardBottle,bk.floatBottle.bottle);baidu.extend(bk.floatBottle.cardBottle.prototype,{check:function(){var A=this,_={action:"throwCheck",propsId:this.propsId||"","bottleContent[type]":this.type,"bottleContent[lemmaId]":this.lemma.lemmaId};baidu.ajax.post(bk.floatBottle.REQ_URLS.BOTTLE_CHECK_URL+"r="+Math.random(),baidu.url.jsonToQuery(_,bk.floatBottle.REPLACE),function(B){var _=baidu.json.parse(B.responseText);if(_.success){A.dispatchEvent("onCheckSuccess");}else{A.dispatchEvent("onCheckFail",{code:_.flag,detail:_.detailFlag});}});},getThrowData:function(){return{propsId:encodeURIComponent(this.propsId),"bottleContent[reason]":encodeURIComponent(this.tag.reason),"bottleContent[content]":encodeURIComponent(this.tag.content),"bottleContent[reference]":encodeURIComponent(this.tag.reference),"bottleContent[part]":encodeURIComponent(this.tag.part)};},getRefuseData:function(){if(!this.refuse){return{};}return{content:encodeURIComponent(this.refuse.reason),reference:encodeURIComponent(this.refuse.reference)};},parseReply:function(_,B){var A=new bk.floatBottle.reply({id:_.id,isOpen:(1==_.isOpen?true:false),from:new bk.usercenter.bottleUser(_.from),to:new bk.usercenter.bottleUser(_.to),bottle:B,type:parseInt(_.type),status:parseInt(_.status),tag:_.content});return A;}});}());baidu.more.ns("bk.usercenter");(function(){bk.usercenter.user=function(_){baidu.extend(this,_);};baidu.lang.inherits(bk.usercenter.user,baidu.lang.Class);baidu.extend(bk.usercenter.user.prototype,{equalTo:function(_){return(_!=null&&_.id==this.id);},getUserIcon:function(){if(0==this.id){return"http://img.baidu.com/img/baike/logo-baike.gif";}return bkuc.user.getUserAvatar(this.avatar,this.level);},toString:function(){return["id:",this.id,",name:",this.name,",level:",this.level];}});}());(function(){var _="/user/ajax/bottle/list?",D="/user/ajax/bottle/salvage?",B="/user/ajax/bottle/throw?",A="/user/ajax/bottle/editInfo?",C="/user/ajax/bottle/arbitration?";bk.usercenter.bottleUser=function(_){bk.usercenter.user.call(this,_);this.bottlesThrow=[];this.bottlesGain=[];this.maxThrowCount=_.throwCount||0;this.maxGainCount=_.gainCount||0;this.hasThrowCount=this.hasGainCount=0;};baidu.lang.inherits(bk.usercenter.bottleUser,bk.usercenter.user);baidu.extend(bk.usercenter.bottleUser.prototype,{throwBottle:function(D){var C=this;if(D.id){C.reThrow(D);return;}var _=D.lemmas[0]||D.lemma,A={r:Math.random(),action:"throwBottle","bottleContent[lemmaId]":_.lemmaId,"bottleContent[lemmaTitle]":encodeURIComponent(_.lemmaTitle),"bottleContent[subLemmaId]":_.subLemmaId,"bottleContent[subLemmaTitle]":encodeURIComponent(_.subLemmaTitle),"bottleContent[type]":D.type};baidu.extend(A,D.getThrowData());baidu.ajax.post(B,baidu.url.jsonToQuery(A,bk.floatBottle.REPLACE),function(A){if(A.responseText){var _=baidu.json.parse(A.responseText);if(_.success){C.dispatchEvent("onThrowSuccess",{actionType:bk.floatBottle.ACTION.THROW});}else{C.dispatchEvent("onThrowFail",{actionType:bk.floatBottle.ACTION.THROW,code:_.flag,detail:_.detailFlag});}}});},reThrow:function(D){var C=this,B=D.replyList[0],_={r:Math.random(),action:"throwAgain",bottleId:D.id,replyId:B.id};baidu.ajax.post(A,baidu.url.jsonToQuery(_),function(A){if(A.responseText){var _=baidu.json.parse(A.responseText);if(_.success){C.dispatchEvent("onThrowSuccess",{actionType:bk.floatBottle.ACTION.RETHROW});}else{C.dispatchEvent("onThrowFail",{actionType:bk.floatBottle.ACTION.RETHROW,code:_.flag,detail:_.detailFlag});}}});},gain:function(){var _=this;bk.usercenter.ajax.post(D+"r="+Math.random(),baidu.url.jsonToQuery({type:bk.floatBottle.BOTTLE_TYPE.CARD}),function(B){if(B.responseText){var A=baidu.json.parse(B.responseText);if(A.error){_.dispatchEvent("onGainFail",{code:A.error,flag:A.flag});}else{_.dispatchEvent("onGainSuccess",{bottle:A});}}});},refuse:function(B){var _=this,C={action:"addReply",bottleId:B.id,r:Math.random()};baidu.extend(C,B.getRefuseData());baidu.ajax.post(A,baidu.url.jsonToQuery(C,bk.floatBottle.REPLACE),function(B){if(B.responseText){var A=baidu.json.parse(B.responseText);if(A.success){_.dispatchEvent("onRefuseSuccess");}else{_.dispatchEvent("onRefuseFail",{code:A.flag,detail:A.detailFlag});}}});},ignore:function(C){var B=this,_={r:Math.random(),action:"ignoreBottle",bottleId:C.id};baidu.ajax.post(A,baidu.url.jsonToQuery(_,bk.floatBottle.REPLACE),function(A){if(A.responseText){var _=baidu.json.parse(A.responseText);if(_.success){B.dispatchEvent("onIgnoreSuccess");}else{B.dispatchEvent("onIgnoreFail");}}});},getBottles:function(A,D,C,B){bk.usercenter.ajax.post(_,baidu.url.jsonToQuery({page:A,action:C,recordPerPage:D,r:Math.random()},bk.floatBottle.REPLACE),function(F){if(F.responseText){var _=baidu.json.parse(F.responseText),E={page:A,action:C,totalRecord:_.totalRecord,recordPerPage:D,bottles:[],recycle:_.recycle};baidu.each(_.bottles,function(_){E.bottles.push(bk.floatBottle.tools.parseRdBottle2My(_));});B&&B(E);}});},agree:function(D){var C=this,B=D.replyList[0],_={r:Math.random(),action:"addThanks",bottleId:D.id,replyId:B.id,content:B.tag.thanksVal};baidu.ajax.post(A,baidu.url.jsonToQuery(_,bk.floatBottle.REPLACE),function(A){if(A.responseText){var _=baidu.json.parse(A.responseText);if(_.success){C.dispatchEvent("onAgreeSuccess");}else{C.dispatchEvent("onAgreeFail");}}});},arbitration:function(B){var A=this,_={r:Math.random(),bottleId:B.id};baidu.ajax.post(C,baidu.url.jsonToQuery(_),function(B){if(B.responseText){var _=baidu.json.parse(B.responseText);if(_.success){A.dispatchEvent("onArbitrationSuccess");}else{A.dispatchEvent("onArbitrationFail");}}});},open:function(_){_.open(this);}});}());baidu.more.ns("bk.usercenter");(function(){bk.usercenter.message=function(_){this._timer=null;this._curReq=null;this._running=false;this.runner=null;_=_||{};this.method=_.method||bk.usercenter.message.REQ_METHOD.GET;this.timeType=_.type||bk.usercenter.message.TIME_TYPE.INTERVAL;if(bk.usercenter.message.TIME_TYPE.INTERVAL==this.timeType){this.reqDuration=_.interval||bk.usercenter.message.DEFAULT_REQ_DURATION;}this.url=_.url;this.urlParams=_.urlParams||{};this.data=_.data||{};baidu.lang.Class.call(this);return this;};baidu.lang.inherits(bk.usercenter.message,baidu.lang.Class);baidu.extend(bk.usercenter.message.prototype,{start:function(){if(this._running){this.cancel();}this._reqStart();this.dispatchEvent("onReqStart");this._running=true;if(bk.usercenter.message.TIME_TYPE.INTERVAL==this.timeType){this._timer=setInterval(baidu.fn.bind(this._reqStart,this),this.reqDuration);}},cancel:function(){this._running=false;clearTimeout(this._timer);this._curReq!=null&&this._curReq.abort();this.dispatchEvent("onReqCancel");},_reqStart:function(){baidu.extend(this.urlParams,{r:Math.random()});if(!(this.urlParams.hasOwnProperty("entry"))){this.urlParams.entry=2;}var _=this.url+baidu.url.jsonToQuery(this.urlParams);this._curReq=baidu.ajax.request(_,bk.usercenter.message.GET_REQ_DATA(this.method,{onsuccess:baidu.fn.bind(this._onSuccess,this),data:this.data}));},_getTag:function(){return this.constructor;},_onSuccess:function(B){var _=B.responseText,A={message:_};if(""==_||"null"==_||/html/.test(_)){this.cancel();this.dispatchEvent("onSessionTimeout",A);if(this.runner){this.runner._processSessionTimeout();}}else{this.dispatchEvent("onDataGet",A);if(this.runner){A.tag=this._getTag();this.runner._processDataGet(A);}}}});baidu.extend(bk.usercenter.message,{TIME_TYPE:{SINGLE:1,INTERVAL:2},REQ_METHOD:{GET:"get",POST:"post"},DEFAULT_REQ_DURATION:300000,GET_REQ_DATA:function(A,B){var _={};_.onsuccess=B.onsuccess;if(A==bk.usercenter.message.REQ_METHOD.POST){_.method="post";_.data=B.data;}return _;}});}());(function(){bk.usercenter.messageRunner=function(){this.messageList=[];this._running=false;return this;};baidu.lang.inherits(bk.usercenter.messageRunner,baidu.lang.Class);baidu.extend(bk.usercenter.messageRunner.prototype,{_processDataGet:function(_){this.dispatchEvent("onDataGet",_);},_processSessionTimeout:function(){this.release();this.dispatchEvent("onSessionTimeout");},_getMessage:function(_){return this.messageList[_]||null;},_getValidMessage:function(_){return baidu.array.filter(_,function(_){if(_!=null){return true;}});},_doAction:function(A,B){var _=this._getValidMessage(A);baidu.each(_,function(_){B.call(_);});},_getList:function(_){var A=[];if(_){A.push(this._getMessage(_));}else{A=this.messageList;}return A;},stop:function(_){var A=bk.usercenter.message.prototype.cancel;this._doAction(this._getList(_),A);this._running=false;},start:function(_){var A=bk.usercenter.message.prototype.start;this._doAction(this._getList(_),A);this._running=true;},addMessage:function(_){this.messageList.push(_);_.runner=this;if(this._running){_.start();}return this;},removeMessage:function(_){var A=parseInt(_,10),B=null;if(!isNaN(A)){B=this._getMessage(A);}else{B=_;}if(B){B.cancel();var D;for(D=0,len=this.messageList.length;D<len;++D){var C=this.messageList[D];if(C==B){this.messageList.splice(D,1,null);}}}},release:function(){this.stop();baidu.each(this.messageList,function(_){if(_){_.cancel();_=null;}});}});}());baidu.more.ns("bk.usercenter");(function(){bk.usercenter.messageBoard=function(C){this._wrap=baidu.g(C.wrap);this._contentWrap=baidu.g(C.contentWrap);this._messages=[];this._className=C.className||"message-board";this._contentWrap.className=this._className;this.maxShowcount=C.maxCount||baidu.usercenter.messageBoard.DEFAULT_COUNT;var A=C.sortFunc,B=C.buildMsgFunc,_=function(A,_){if(_){return A.sort(_);}return A;};baidu.extend(this,{show:function(){baidu.dom.show(this._wrap);},hide:function(){baidu.dom.hide(this._wrap);},close:function(){this.clearMessages();this._wrap.parentNode.removeChild(this._wrap);},getWrapDomChindren:function(){return baidu.dom.query("."+this._className+" ul li");},clearMessages:function(){var _=this._messages;baidu.each(this.getWrapDomChindren(),function(C,A){var B=baidu.dom.getAttr(C,"click");if(B){baidu.un(C,"click",_[A].handler);}});this._contentWrap.innerHTML="";this._messages=[];},setMessages:function(G){this.clearMessages();if(baidu.lang.isArray(G)){this._messages=[].concat(G);}else{this._messages.push(G);}var H=_(this._messages,A),F=Math.min(this.maxShowcount,H.length),E=document.createElement("ul"),I;for(I=0;I<F;++I){if(B){var C=B(this._messages[I]);if(C){var D=document.createElement("li");D.appendChild(C);E.appendChild(D);}}}this._contentWrap.appendChild(E);}});};baidu.extend(bk.usercenter.messageBoard,{DEFAULT_COUNT:4});}());baidu.more.ns("bk.floatBottle");bk.floatBottle.tools=(function(){if(typeof bk.floatBottle.tools!=="undefined"){return bk.floatBottle.tools;}var A={1:["\u5df2\u53d1\u51fa","s5","send"],2:["\u5f85\u8bc4\u4ef7","s6","uncomment"],3:["\u5df2\u5904\u7406","s1","solve"],4:["\u5f85\u5904\u7406","s4","unedit"],5:["\u8fdb\u884c\u4e2d","s3","going"],6:["\u5df2\u5b8c\u6210","s1","success"],7:["\u5df2\u5173\u95ed","s2","fail"],8:["\u5df2\u6295\u8bc9","s4","complaint"]};function I(D,C,B){D=baidu.g(D);var _=D.innerText||D.textContent,A=new RegExp(C);if(A.test(_)){_=_.replace(A,function(_){return'<span style="color:red" onclick="this.style.color=\'\'">'+_+"</span>";});D.innerHTML=_;B&&B(C);}}function H(B,_,C){if(B.setSelectionRange){B.setSelectionRange(_,C);}else{if(B.createTextRange){var A=B.createTextRange();A.collapse(true);A.moveStart("character",_);A.moveEnd("character",C-_);A.select();}}B.focus();}function D(E,A,C,B){E=baidu.g(E);var D=A.indexOf(C);if(-1!=D){var _=D+C.length;H(E,D,_);B&&B(C);}}function E(C,E){var B=/(\{\w+\})/g,_=C.match(B);if(!_||0==(len=_.length)){return C;}var G;for(G=len;G--;){var F=_[G],A=F.length-2,D=F.substr(1,A);if(!E.hasOwnProperty(D)){E[D]="";}C=C.replace(new RegExp(F,"g"),E[D]);}return C;}function C(F,K,E){var M=F.thrower,J=M.name;if(0==M.id){M.name="\u7cfb\u7edf";}var L=M.getUserIcon(),G=F.fromDate.split(" ")[0],D=bk.floatBottle.GET_BOTTLE_STATUS(parseInt(F.status),K),H=A[D],_=F.thrower,B=F.lemmas[0],I=_.equalTo(E)?"\u60a8\u53d1\u51fa\u6c42\u52a9\u74f6":"\u60a8\u6536\u5230"+_.name+"\u7684\u6c42\u52a9\u74f6",C={name:J,src:L,id:F.id,date:G,statusMsg:H[0],statusClass:H[1],openClass:(1==F.isOpen?"":"unopen"),contentStr:I,lemmaId:B.lemmaId,lemmaTitle:B.lemmaTitle+(B.subLemmaTitle?"-"+B.subLemmaTitle:"")};return C;}function G(_){var B=bk.floatBottle.GET_BOTTLE_CONT(_.type),C={id:_.id,from:new bk.usercenter.user(_.from),fromDate:_.throwDate,isOpen:_.isOpen,type:_.type,status:_.status,thrower:new bk.usercenter.user(_.user),lemmas:[{lemmaId:_.lemmaId,lemmaTitle:_.lemmaTitle,subLemmaId:_.subLemmaId,subLemmaTitle:_.subLemmaTitle,versionId:_.versionId,subVersionId:_.subVersionId}]};if(_.content){baidu.extend(C,{tag:_.content});}var A=new B(C);return A;}function B(_){_.stopPropagation();}function _(_){var A=[];A.push({type:1,length:_.bottle?_.bottle.length:0});A.push({type:2,length:_.reply?_.reply.length:0});A.canEditCard=_.canEditCard=="y"?true:false;return A;}function F(_,B,A){if(typeof _=="undefined"){return;}bk.usercenter.ajax.get("/user/ajax/bottle/setting?receiveMsg="+_+"&r="+Math.random(),function(C){var _=baidu.json.parse(C.responseText);if(_.success&&B){B();}else{A&&A();}});}return{highlight:I,textSelect:D,substitude:E,cancelEvent:B,translateMessage:_,parseMyBottle2UI:C,parseRdBottle2My:G,saveSetting:F};}());baidu.more.ns("bk.lemma");bk.lemma.bottleMessage=(function(){var L={BOTTLE:1,REPLY:2,CLOSE:3,STOP:4},N="/user/ajax/bottle/notice?",Q=3,_=0,P=null,H=null,O=false,K=bk.floatBottle.tools,G,C;function B(){var _=H;if(6===baidu.ie){_.style.setExpression("zoom",'function(ele){ele.style.top = Math.max(baidu.page.getScrollTop(), 30) +"px";}(this)');}function A(){var B=30,A=baidu.page.getScrollTop();if(A>30){B=0;}if(6!==baidu.ie){_.style.top=B+"px";}}A();baidu.on(window,"resize",A);baidu.on(window,"scroll",A);baidu.on(window,"unload",function(){baidu.un(window,"resize",A);baidu.un(window,"scroll",A);});}function D(){H=I();B();C=new bk.usercenter.messageBoard({wrap:H,contentWrap:"btl-indicator-content",maxCount:Q,buildMsgFunc:F});G=new bk.usercenter.message({url:N,urlParams:{type:1},type:bk.usercenter.message.TIME_TYPE.INTERVAL,interval:600000});G.addEventListener("onDataGet",A);G.start();}function I(){var _=document.createElement("div");_.id="btl-msg-indicator";_.className="float-board";_.style.display="none";_.innerHTML='<div class="btl-indicator"><div id="btl-indicator-content"></div><a class="close" '+'onclick="bk.lemma.bottleMessage.close()" href="javascript:;">\xd7</a></div>';document.body.appendChild(_);return _;}function A(A){var B=K.translateMessage(baidu.json.parse(A.message));if(0==B[0].length&&0==B[1].length&&0==_){P=new bk.ui.enctip();P.init();O=true;}if(B[1].length>0&&B.canEditCard===false){if(O){P&&P.close();O=false;}C.show();B.push({type:L.CLOSE});C.setMessages(B);}_++;}function F(B){var A=document.createElement("div"),_="";switch(B.type){case L.BOTTLE:if(B.length>0){_='<span class="dot"></span><span class="msg-content">\u6709<span style="color:red">1</span>\u4e2a\u6c42\u52a9\u74f6\u6f02\u6765\u4e86\uff0c'+'<a href="/uc/bottle#1" target="_blank" onclick="bk.lemma.bottleMessage.close()">\u53bb\u635e\u74f6\u5b50\u5e2e\u5fd9</a></span>';}break;case L.REPLY:if(B.length>0){_='<span class="dot"></span><span class="msg-content"><strong><span class="red">'+B.length+'</span></strong>\u4e2a\u6c42\u52a9\u74f6\u6709\u65b0\u52a8\u6001\uff0c<a href="/uc/bottle#2" target="_blank" onclick="bk.lemma.bottleMessage.close()">\u67e5\u770b\u6211\u7684\u74f6\u5b50</a></span>';}break;case L.CLOSE:A.style.cssText="text-align:right;padding:.5em .5em 0 0;";_='<a href="javascript:;" onclick="bk.lemma.bottleMessage.stopMessage();">\u4e0d\u518d\u63d0\u793a</a>';break;case L.STOP:_='\u8bbe\u7f6e\u6210\u529f\uff01<span style="color:#999">\u53ef\u5728\u201c\u4e2a\u4eba\u4e2d\u5fc3-\u6211\u7684\u6c42\u52a9\u74f6-\u8bbe\u7f6e\u201d\u4e2d\u91cd\u65b0\u5f00\u542f\u3002</span>';break;}A.innerHTML=_;if(_==""){return null;}return A;}function M(){G.cancel();C.close();}function J(){C.setMessages([{type:L.STOP}]);if("undefined"!=typeof easy.fx){var _=new easy.fx({selector:H,duration:210,animate:true,from:[["opacity",1,0]],to:[["opacity",0,0]],onStart:function(){G.cancel();return true;},onStop:function(){C.close();}});setTimeout(function(){_.start();},2000);}else{M();}}function E(){baidu.ajax.get("/user/ajax/bottle/setting?receiveMsg=0&r="+Math.random(),function(A){var _=baidu.json.parse(A.responseText);if(_.success){J();}});}return{run:D,stopMessage:E,start:function(){G.start();},stop:function(){G.cancel();},close:M};}());baidu=baidu||{};baidu.bottle=(function(){var _;return{closeDialog:function(){_.close();},throwBottle:function(H){H=H||{};var F=H.lemmaId,_=H.lemmaTitle,E=H.userId,B=H.modType,J=H.subLemmaId,A=H.subLemmaTitle,D=H.propsId||"",C=H.link;if(C&&typeof curUser!=="undefined"&&curUser.forbid===true){C.href="/error/forbid";C.target="_blank";return true;}A=A||"";if(!A&&baidu.g("polysemy-sub-lemma-desc-temp")&&"undefined"!==typeof EditHelpConf&&EditHelpConf.isPolysemy){A=baidu.g("polysemy-sub-lemma-desc-temp").value;}if(!J&&baidu.g("polysemy-sub-lemma-id")&&"undefined"!==typeof EditHelpConf&&EditHelpConf.isPolysemy){J=baidu.g("polysemy-sub-lemma-id").value;}var I=new bk.floatBottle.cardBottle({lemmas:[{lemmaId:F,lemmaTitle:_}],propsId:D}),G=this;I.addEventListener("onCheckSuccess",function(){G._doThrwoBottle(F,_,E,B,J,A,D);});I.addEventListener("onCheckFail",function(_){var A=["","\u6b63\u5e38","\u6765\u6e90\u8bcd\u6216\u8005\u9501\u5b9a\u8bcd","\u74f6\u5b50\u6254\u8fc7\u4e86","\u6b21\u6570\u8d85\u8fc7","\u5305\u542b\u654f\u611f\u8bcd","\u63d0\u4ea4\u9a8c\u8bc1\u5931\u8d25","\u6254\u74f6\u5b50\u5931\u8d25","\u6254\u6210\u529f","\u672c\u671f\u6c42\u52a9\u74f6\u4ec5\u5f00\u653e\u540d\u7247\u6c42\u52a9\u3002\u60a8\u5df2\u7ecf\u6709\u540d\u7247\u6743\u9650\uff0c\u5feb\u53bb\u53d1\u6325\u7279\u6743\uff0c\u635e\u74f6\u5b50\u5e2e\u52a9\u522b\u4eba\u5427\uff01"];if(_.code===2){G.showDialog("lockedlemma");}else{if(_.code===3){G.showDialog("versionconflict");}else{if(_.code===4){G.showDialog("nobottle",{nums:_.detail,btlParams:H});}else{if(_.code==7){G.showDialog("forbid");}else{if(_.code==-3){G.showDialog("nouser");}else{if(_.code===9){G.showDialog("canedit");}else{alert(A[_.code]);}}}}}}});I.check();return false;},_doThrwoBottle:function(G,A,F,D,H,C,E){D=D||1;var B="/static/usercenter/page/throwbtl.html?lemmaId="+G+"&lemmaTitle="+encodeURIComponent(A)+"&userId="+F+"&type="+D+"&polysemy="+encodeURIComponent(C)+"&polysemyId="+(H)+"&propsId="+(E);_=Fe.Dialog.open(B,{title:"\u53d1\u9001\u6c42\u52a9\u74f6",width:"483px",height:"490px",buttonAcceptValue:"\u6254\u51fa\u53bb",buttonCancelValue:"\u4e0d\u6254\u4e86",buttonbar:true,buttonAccept:true,buttonCancel:true,contentType:"HTMLUrl",locked:true,onaccept:function(){if(_.getIframe()){_.getIframe().contentWindow.throwBottle();}}});_.addEventListener("onaccept",function(_){_.returnValue=false;});},showDialog:function(D,E){var _="",A;switch(D){case"lockedlemma":Detect.content="<p>\u6765\u6e90\u8bcd\u6216\u9501\u5b9a\u8bcd\u4e0d\u80fd\u8fdb\u884c\u6c42\u52a9\u3002</p>";_="\u4e0d\u80fd\u6c42\u52a9";break;case"nouser":Detect.content="<p>\u7528\u6237\u540d\u4e0d\u5b58\u5728\uff0c\u8bf7\u5148\u586b\u5199\u7528\u6237\u540d\u3002</p>";_="\u53d1\u9001\u6c42\u52a9\u74f6";break;case"versionconflict":Detect.content="<p>\u5df2\u6709\u79d1\u53cb\u5bf9\u8be5\u8bcd\u6761\u7684\u540d\u7247\u53d1\u8d77\u4e86\u6c42\u52a9\uff0c\u6c42\u52a9\u6b63\u5728\u8fdb\u884c\u4e2d\u3002\u4f11\u606f\u4e00\u4e0b\uff0c\u4e00\u4f1a\u513f\u518d\u6765\u770b\u770b\u5427\u3002</p>";_="\u53d1\u9001\u6c42\u52a9\u74f6";break;case"nobottle":if(bk.shop&&bk.shop.propsBox&&bk.shop.propsBox.unUsedBottleProps.length>0){var B=bk.shop.propsBox.unUsedBottleProps[0];A=new bk.shop.DialogHelper();A.addContent("\u6bcf\u4eba\u6bcf\u5929\u53ea\u6709"+E.nums+"\u4e2a\u74f6\u5b50\uff0c\u4eca\u5929\u7684\u74f6\u5b50\u7528\u5b8c\u5566\uff01<br/><br/>");A.addContent("\u9053\u5177\u5305\u4e2d\u6709\u4e00\u4e2a\u53d1\u74f6\u5b50\u9053\u5177\uff0c\u53ef\u4ee5\u4f7f\u7528\u9053\u5177\u53d1\u51fa\u3002<br/>");A.addContent("\u786e\u8ba4\u4f7f\u7528\u5417\uff1f<br/>");A.addBtn({text:"\u4f7f\u7528",onclick:function(){nslog(location.href,3620,{t1:4});var _=new bk.shop.PropsManager();_.addEventListener("propsused",function(_){C.close();E.btlParams.propsId=_.props.propsId;baidu.bottle.throwBottle(E.btlParams);});_.useProps(B);}});A.addBtn({text:"\u53d6\u6d88",onclick:function(){C.close();}});A.addFooter('\u4f60\u4e5f\u53ef\u4ee5\u53c2\u52a0<a href="/uc/task#1" target="_blank">\u6210\u957f\u4efb\u52a1</a>\uff0c\u52a0\u901f\u5347\u7ea7\uff0c\u81ea\u5df1\u83b7\u5f97\u6743\u9650\u6765\u7f16\u8f91\uff01');var C=new bk.Dialog({titleText:"\u74f6\u5b50\u4e0d\u591f\u5566",width:400,height:"auto",autoRender:true,contentText:A.render(),modal:true,buttonbar:false,onload:A.onDialogLoad()});C.open();return;}Detect.content="\u6bcf\u4eba\u6bcf\u5929\u53ea\u6709"+E.nums+'\u4e2a\u74f6\u5b50\uff0c\u4eca\u5929\u7684\u74f6\u5b50\u7528\u5b8c\u5566\uff01<br/><br/>\u53ef\u4ee5\u53bb<a href="/mall" target="_blank">\u767e\u79d1\u5546\u57ce</a>\u5151\u6362\u65b0\u6c42\u52a9\u74f6\u6743\u9650\u53d1\u51fa\u6c42\u52a9\u3002'+'<br/><br/>\u4f60\u4e5f\u53ef\u4ee5\u53c2\u52a0<a href="/uc/task#1" target="_blank">\u6210\u957f\u4efb\u52a1</a>\uff0c\u52a0\u901f\u5347\u7ea7\uff0c\u81ea\u5df1\u83b7\u5f97\u6743\u9650\u6765\u7f16\u8f91\uff01';_="\u74f6\u5b50\u4e0d\u591f\u5566";break;case"canedit":Detect.content="\u672c\u671f\u6c42\u52a9\u74f6\u4ec5\u5f00\u653e\u540d\u7247\u6c42\u52a9\u3002\u60a8\u5df2\u7ecf\u6709\u540d\u7247\u6743\u9650\uff0c\u5feb\u53bb\u53d1\u6325\u7279\u6743\uff0c\u635e\u74f6\u5b50\u5e2e\u52a9\u522b\u4eba\u5427\uff01<br/>\u6709\u6c42\u52a9\u9700\u7f16\u8f91\u65f6\uff0c\u4f1a\u6709\u5c0f\u6c14\u6ce1\u63d0\u793a\u60a8\uff0c\u4e5f\u53ef\u4ee5\u968f\u65f6\u53bb\u201c\u4e2a\u4eba\u4e2d\u5fc3-\u6211\u7684\u6c42\u52a9\u74f6\u201d\u635e\u53d6\u3002";_="\u60a8\u5df2\u6709\u540d\u7247\u6743\u9650";break;case"forbid":Detect.content="\u60a8\u7684\u8d26\u6237\u5df2\u88ab\u5c01\u7981,\u4e0d\u80fd\u635e\u53d6\u6c42\u52a9\u74f6\u3002";_="\u4f60\u7684\u8d26\u6237\u5df2\u88ab\u5c01\u7981";break;default:Detect.content="\u51fa\u9519\u4e86\uff01";_="\u51fa\u9519\u4e86\uff01";break;}Fe.Dialog.open("/page/privcheck.html",{title:_,width:"402px",height:"180px",buttonbar:true,buttonAccept:true,buttonCancel:false,contentType:"HTMLUrl",locked:true});}};}());baidu.dom.ready(function(){var A=baidu.g("lemmaid");if(!A){return;}A=A.value;if(!A){return;}var C="/user/ajax/bottle/getinfo",_="lemmaId="+A,B=function(_,B){if(!B||"null"===B||"[]"===B||/html/.test(B)){return;}var A=baidu.json.parse(B);baidu.g("tip-btl-content-mod").innerHTML=A.content.content;baidu.g("tip-btl-content-reason").innerHTML=A.content.reason;baidu.g("tip-btl-content-ref").innerHTML=A.content.reference;baidu.g("tip-btl-link").href=baidu.g("tip-btl-link").href+A.id;baidu.g("tip-btl").style.display="block";if(baidu.g("bottle-info")){baidu.g("bottle-info").style.display="";}};baidu.ajax.post(C,_,B);});baidu.more.ns("bk.shop");bk.shop.BusinessError=function(_){if(baidu.isString(_)){this.message=_;}else{baidu.extend(this,_||{});}this.errmsg=String(this.flag);this.errno=parseInt(this.errno)||this.errno;};bk.shop.BusinessError.prototype={name:"bkshopBusinessError",errno:"",message:""};baidu.more.ns("bk.shop");bk.shop.Commodity=function(_){_=_||{};this.id="";this.name="";this.classId="";this.className="";this.imgSrc="";this.imgHref="";baidu.extend(this,_);};bk.shop.Commodity.prototype={PURCHASE_URL:"/mall/exchange",id:"",name:"",classId:"",imgSrc:"",imgHref:"",className:"",shareText:"",onbeforepurchase:function(){},onpurchase:function(){},onpurchaseerr:function(B){var _=B.errno,D=B.errmsg,A=new bk.shop.DialogHelper();switch(_){case 1:A.addContent(">_< \u62b1\u6b49\uff0c\u5b83\u592a\u53d7\u6b22\u8fce\uff0c\u88ab\u62a2\u5b8c\u5566\uff01<br/>");A.addContent("\u53bb\u770b\u770b\u5176\u5b83\u5546\u54c1\u5427\uff01<br/>");break;case 2:A.addContent(">_< \u62b1\u6b49\uff0c\u4e0d\u5728\u5151\u6362\u65f6\u95f4\u54df\uff01<br/>");A.addContent("\u5f00\u59cb\u518d\u6765\u5427\uff01<br/>");break;case 3:if(this.consumeType==bk.shop.Commodity.CONSUME_TYPES.WEALTH){A.addContent(">_< \u62b1\u6b49\uff0c\u4f60\u7684\u8d22\u5bcc\u503c\u4e0d\u591f\uff01<br/>");A.addContent("\u5feb\u53bb\u591a\u8d5a\u4e9b\u8d22\u5bcc\u503c\u5427\uff01<br/>");}else{A.addContent(">_< \u62b1\u6b49\uff0c\u4f60\u7684\u79ef\u5206\u4e0d\u591f\uff01<br/>");A.addContent('\u5feb\u53bb\u591a\u8d5a\u4e9b\u79ef\u5206\u5427\uff01<a href="/mall#getScore">\u53bb\u8d5a\u5206</a><br/>');}break;case 4:A.addContent(">_< \u62b1\u6b49\uff0c\u4f60\u7684 "+(bk.shop.Commodity.CONDITION_NAMES[D]||"\u6761\u4ef6")+" \u672a\u6ee1\u8db3\uff01<br/>");A.addContent("\u5feb\u53bb\u52a0\u6cb9\u8fbe\u5230\u5427\uff01<br/>");break;case 5:var E=D.split(",");if(E.length==2){A.addContent(">_< \u62b1\u6b49\uff0c\u8be5\u5546\u54c1\u6bcf"+bk.shop.hourToDay(E[1])+"\u53ea\u80fd\u5151\u6362"+E[0]+"\u4e2a!<br/>");}else{A.addContent(">_< \u62b1\u6b49\uff0c\u8be5\u5546\u54c1\u53ea\u80fd\u5151\u6362"+D+"\u4e2a!<br/>");}break;case 6:A.addContent(">_< \u62b1\u6b49\uff0c\u4f60\u5df2\u62e5\u6709\u8be5\u5546\u54c1\uff0c\u4e0d\u80fd\u518d\u5151\u6362\u4e86\uff01<br/>");break;case 7:A.addContent(">_< \u62b1\u6b49\uff0c\u5151\u6362\u5df2\u7ed3\u675f\uff01<br/>");A.addContent("\u4e0b\u6b21\u65e9\u70b9\u6765\u5427\uff01<br/>");break;case 8:A.addContent("\u8d26\u53f7\u5f02\u5e38\uff0c\u65e0\u6cd5\u5151\u6362\uff01<br/>");break;case 9:A.addContent("\u60a8\u5df2\u7ecf\u6709\u540d\u7247\u6743\u9650\uff0c\u4e0d\u80fd\u5151\u6362\u8be5\u5546\u54c1\uff01<br/>");break;case 240006:A.addContent(">_< \u7528\u6237\u540d\u4e0d\u5b58\u5728\uff0c\u8bf7\u5148\u586b\u5199\u7528\u6237\u540d\uff01<br/>");break;default:A.addContent(">_< \u62b1\u6b49\uff0c\u5151\u6362\u5931\u8d25\uff01");A.addContent("\u8bf7\u7a0d\u540e\u91cd\u8bd5\u3002<br/>");}A.addBtn({text:"\u786e\u5b9a",onclick:function(){C.close();}});var C=new bk.Dialog({titleText:"\u5151\u6362\u5931\u8d25",contentText:A.render(),modal:true,buttonbar:false,onload:A.onDialogLoad()});C.open();},getPurchaseParams:function(){return{id:this.id,name:encodeURIComponent(this.name),classId:this.classId};},purchase:function(){var _=this;if(_.onbeforepurchase()!==false){baidu.ajax.post(_.PURCHASE_URL,baidu.url.jsonToQuery(_.getPurchaseParams(),bk.shop.replace),function(C){var A=baidu.json.parse(C.responseText);if(A.success){_.dispatchEvent("purchase",{commodity:_,reqResult:A});}else{var B=new bk.shop.BusinessError(A);_.dispatchEvent("purchaseerror",{commodity:_,err:B});_.onpurchaseerr.call(_,B,B);}});}}};bk.shop.Commodity.TYPE={"1":"Medal","2":"VirtualFigure","3":"DoubleExpByTime","4":"DoubleExpByVersion","5":"CardEditToken","6":"BottleProps","7":"RealThing"};bk.shop.Commodity.CONDITION_NAMES={level:"\u7b49\u7ea7",pass_rate:"\u901a\u8fc7\u7387",cp_version:"\u590d\u6742\u7248\u672c\u6570",hq_version:"\u9ad8\u8d28\u91cf\u7248\u672c\u6570",gq_version:"\u4f18\u8d28\u7248\u672c\u6570",role:"\u7528\u6237\u89d2\u8272"};bk.shop.Commodity.CONSUME_TYPES={SCORE:1,WEALTH:2};baidu.lang.inherits(bk.shop.Commodity,baidu.lang.Class);bk.shop.BaseProps=function(){bk.shop.BaseProps.superClass.constructor.apply(this,arguments);if(typeof this.tinySrc=="undefined"){this.tinySrc=this.imgSrc;}};bk.shop.BaseProps.prototype={isProps:true,propsId:-1,used:false,onbeforeuse:function(){},onuse:function(){},useInfoTpl:"#{name}\u4f7f\u7528\u4e2d.</a>",usableInfoTpl:'\u53ef\u4f7f\u7528#{name}\uff01\u70b9\u51fb\u5373\u53ef<a href="javascript:;" onclick="bk.shop.useProps({propsId:#{propsId},classId:#{classId}});return false;">\u5f00\u542f\u4f7f\u7528</a>',onuseerr:function(B){var _=B.errno,A=new bk.shop.DialogHelper();switch(_){case 2:A.addContent("\u9053\u5177\u65e0\u6548\uff01<br/>");break;case 3:A.addContent(">_< \u62b1\u6b49\uff0c\u60a8\u5df2\u4f7f\u7528\u8be5\u9053\u5177\uff0c\u4e0d\u80fd\u91cd\u590d\u4f7f\u7528\uff01<br/>");break;default:A.addContent(">_< \u62b1\u6b49\uff0c\u4f7f\u7528\u9053\u5177\u5931\u8d25\uff01");A.addContent("\u8bf7\u7a0d\u540e\u91cd\u8bd5\u3002<br/>");}A.addBtn({text:"\u786e\u5b9a",onclick:function(){C.close();}});var C=new bk.Dialog({titleText:"\u4f7f\u7528\u9053\u5177\u5931\u8d25",contentText:A.render(),modal:true,buttonbar:false,onload:A.onDialogLoad()});C.open();},renderUseInfoTo:function(B){var _=B.id,A=B.tpl||this.useInfoTpl,C=baidu.string.format(A,this);_=baidu.g(_);if(_){_.innerHTML=C;}return C;},renderUsableInfoTo:function(B){var _=B.id,A=B.tpl||this.usableInfoTpl,C=baidu.string.format(A,this);_=baidu.g(_);if(_){_.innerHTML=C;}return C;}};bk.shop.BaseProps.NAMES={DoubleExpByTime:"DoubleExpByTime",DoubleExpByVersion:"DoubleExpByVersion",CardEditToken:"CardEditToken",BottleProps:"BottleProps"};baidu.lang.inherits(bk.shop.BaseProps,bk.shop.Commodity);bk.shop.CountLimitedProps=function(){bk.shop.CountLimitedProps.superClass.constructor.apply(this,arguments);};bk.shop.CountLimitedProps.prototype={countLimited:true,count:-1};baidu.lang.inherits(bk.shop.CountLimitedProps,bk.shop.BaseProps);bk.shop.TimeLimitedProps=function(){bk.shop.TimeLimitedProps.superClass.constructor.apply(this,arguments);this.countDownTime=this.leftTime;this.createTime=new Date().getTime();};bk.shop.TimeLimitedProps.prototype={timeLimited:true,leftTime:-1,period:60000,useInfoTpl:"\u6b63\u5728\u4f7f\u7528#{name},\u5269\u4f59\u65f6\u95f4:#{leftHour}:#{leftMinute}:#{leftSecond}",usableInfoTpl:'\u53ef\u4f7f\u7528#{name}\uff01\u70b9\u51fb\u5373\u53ef<a href="javascript:;" onclick="bk.shop.useProps({propsId:#{propsId},classId:#{classId}});return false;">\u5f00\u542f\u4f7f\u7528</a>',countDown:function(B){this.stopCountDown();var A=this;A.countDownTime-=parseInt((new Date().getTime()-A.createTime)/1000);B=Math.max(B||this.period,1000);var _=A.countDownTime%(B/1000);if(_>0){_+=1/60;}A.addEventListener("countdown",A.refreshUseInfo);A.countDownTimer=setTimeout(function(){A.countDownTime-=_;A.countDownInterval=setInterval(function(){A.countDownTime-=B/1000;if(A.countDownTime<=0){A.countDownTime=0;A.stopCountDown();}A.fireCountDownEvent();},B);A.fireCountDownEvent();},_*1000);A.fireCountDownEvent();},setLeftTime:function(_){this.leftTime=_;this.countDownTime=this.leftTime;this.createTime=new Date().getTime();},stopCountDown:function(){if(this.countDownTimer){clearTimeout(this.countDownTimer);}if(this.countDownInterval){clearInterval(this.countDownInterval);}this.removeEventListener("countdown",this.refreshUseInfo);},fireCountDownEvent:function(){var A=this;A.leftHour=parseInt(A.countDownTime/3600);A.leftMinute=parseInt(A.countDownTime%3600/60);A.leftSecond=A.countDownTime%60;var _={hour:A.leftHour,minute:A.leftMinute,second:A.leftSecond};A.dispatchEvent("countdown",{countdownTime:_,props:A});},refreshUseInfo:function(){var B=this,A,_=bk.shop.TimeLimitedProps;if(this.used){baidu.array.each(_.useInfoEls,function(_){A=baidu.g(_.id);if(!A){return;}A.innerHTML=baidu.string.format(_.tpl,B);});}else{baidu.array.each(_.usableInfoEls,function(_){A=baidu.g(_.id);if(!A){return;}A.innerHTML=baidu.string.format(_.tpl,B);});}},findElById:function(_,A){for(var C=0,B=A.length;C<B;C++){if(A[C].id==_){return C;}}return-1;},renderUseInfoTo:function(B){var A=bk.shop.TimeLimitedProps;B.tpl=B.tpl||this.useInfoTpl;var _=this.findElById(B.id,A.useInfoEls);if(_>=0){A.useInfoEls.splice(_,1);}_=this.findElById(B.id,A.usableInfoEls);if(_>=0){A.usableInfoEls.splice(_,1);}A.useInfoEls.push(B);},renderUsableInfoTo:function(B){var A=bk.shop.TimeLimitedProps;B.tpl=B.tpl||this.usableInfoTpl;var _=this.findElById(B.id,A.useInfoEls);if(_>=0){A.useInfoEls.splice(_,1);}_=this.findElById(B.id,A.usableInfoEls);if(_>=0){A.usableInfoEls.splice(_,1);}A.usableInfoEls.push(B);}};bk.shop.TimeLimitedProps.useInfoEls=[];bk.shop.TimeLimitedProps.usableInfoEls=[];baidu.lang.inherits(bk.shop.TimeLimitedProps,bk.shop.BaseProps);bk.shop.BottleProps=function(){bk.shop.BottleProps.superClass.constructor.apply(this,arguments);};bk.shop.BottleProps.prototype={isBottleProps:true,onpurchase:function(){var _=new bk.shop.DialogHelper();_.addContent("\u606d\u559c\uff0c\u5151\u6362\u6210\u529f\uff01^_^<br/>");_.addContent("\u53ef\u4ee5\u53bb\u6254\u51fa\u4f60\u8981\u6c42\u52a9\u7684\u74f6\u5b50\u5566~");_.addBtn({text:"\u786e\u5b9a",onclick:function(){A.close();}});_.addBtn('<a href="/uc/score" target="_blank">\u67e5\u770b\u5151\u6362\u8bb0\u5f55&gt;&gt;</a>');_.addFooter("\u6e29\u99a8\u63d0\u793a\uff1a\u5728\u9700\u8981\u6c42\u52a9\u7684\u8bcd\u6761\uff0c\u70b9\u51fb\u201c\u6c42\u52a9\u7f16\u8f91\u201d\u5373\u53ef\u4f7f\u7528\u3002");var A=new bk.Dialog({titleText:"\u5151\u6362\u6210\u529f",contentText:_.render(),modal:true,width:400,buttonbar:false,onload:_.onDialogLoad()});A.open();}};baidu.lang.inherits(bk.shop.BottleProps,bk.shop.BaseProps);bk.shop.CardEditToken=function(){bk.shop.CardEditToken.superClass.constructor.apply(this,arguments);};bk.shop.CardEditToken.prototype={isCardEditToken:true,onpurchase:function(){var _=new bk.shop.DialogHelper();_.addContent("\u606d\u559c\uff0c\u5151\u6362\u6210\u529f\uff01^_^<br/>");_.addContent("\u5feb\u53bb\u7f16\u8f91\u540d\u7247\u8bd5\u8bd5\u8eab\u624b\u5427~");_.addBtn({text:"\u786e\u5b9a",onclick:function(){A.close();}});_.addBtn('<a href="/uc/score" target="_blank">\u67e5\u770b\u5151\u6362\u8bb0\u5f55&gt;&gt;</a>');_.addFooter("\u6e29\u99a8\u63d0\u793a\uff1a\u5728\u7f16\u8f91\u8bcd\u6761\u72b6\u6001\u4e0b\uff0c\u70b9\u51fb\u201c\u7f16\u8f91\u540d\u7247\u201d\u5373\u53ef\u4f7f\u7528\u3002");var A=new bk.Dialog({titleText:"\u5151\u6362\u6210\u529f",contentText:_.render(),modal:true,width:400,buttonbar:false,onload:_.onDialogLoad()});A.open();}};baidu.lang.inherits(bk.shop.CardEditToken,bk.shop.BaseProps);bk.shop.DoubleExpByTime=function(){bk.shop.DoubleExpByTime.superClass.constructor.apply(this,arguments);};bk.shop.DoubleExpByTime.prototype={onpurchase:function(){var A=this,_=new bk.shop.DialogHelper();_.addContent("\u606d\u559c\uff0c\u5151\u6362\u6210\u529f\uff01^_^<br/>");_.addContent("\u5feb\u4f7f\u7528\u5b83\u52a0\u901f\u5347\u7ea7\u5427!");_.addBtn({text:"\u4f7f\u7528",tpl:'<a href="/uc/prop#act=useItem&id='+A.id+'" target="_blank" class="bk-dialog-accept" id="#{id}" '+'onclick="javascript:#{onclick}"><div class="bk-dialog-button-label">#{text}</div></a>',onclick:function(){B.close();}});_.addBtn('<a href="/uc/score" target="_blank">\u67e5\u770b\u5151\u6362\u8bb0\u5f55&gt;&gt;</a>');_.addFooter("\u6e29\u99a8\u63d0\u793a\uff1a\u4e5f\u53ef\u4ee5\u5728\u7f16\u8f91\u8bcd\u6761\u65f6\u70b9\u51fb\u4f7f\u7528\uff0c\u5f00\u542f\u8ba1\u65f6~");var B=new bk.Dialog({titleText:"\u5151\u6362\u6210\u529f",width:350,contentText:_.render(),modal:true,buttonbar:false,onload:_.onDialogLoad()});B.open();},onuse:function(){var _=new bk.shop.DialogHelper();_.addContent("\u4f7f\u7528\u6210\u529f\uff01^_^<br/>");_.addContent("\u5f00\u59cb\u8ba1\u65f6\u5566\uff0c12\u5c0f\u65f6\u5185\u7f16\u8f91\u7684\u6240\u6709\u7248\u672c\uff0c\u5728\u901a\u8fc7\u540e\u4f1a\u83b7\u5f97\u53cc\u500d\u79ef\u5206\u54e6\uff0c\u5feb\u53bb\u7f16\u8f91\u64c5\u957f\u7684\u8bcd\u6761\u5427~");_.addBtn({text:"\u786e\u5b9a",onclick:function(){A.close();}});_.addFooter('\u6e29\u99a8\u63d0\u793a\uff1a\u7f16\u8f91\u6c42\u52a9\u74f6\u8bcd\u6761\uff0c\u7ecf\u9a8c\u503c\u66f4\u591a\u54e6\uff01<a href="/uc/bottle#1">\u635e\u74f6\u5b50\u53bb>></a>');var A=new bk.Dialog({titleText:"\u4f7f\u7528\u6210\u529f",width:400,contentText:_.render(),modal:true,buttonbar:false,onload:_.onDialogLoad()});A.open();}};baidu.lang.inherits(bk.shop.DoubleExpByTime,bk.shop.TimeLimitedProps);bk.shop.DoubleExpByVersion=function(){bk.shop.DoubleExpByVersion.superClass.constructor.apply(this,arguments);};bk.shop.DoubleExpByVersion.prototype={doubleExpByVersion:true,onpurchase:function(){var _=new bk.shop.DialogHelper();_.addContent("\u606d\u559c\uff0c\u5151\u6362\u6210\u529f\uff01^_^<br/>");_.addContent("\u5feb\u4f7f\u7528\u5b83\u52a0\u901f\u5347\u7ea7\u5427!");_.addBtn({text:"\u786e\u5b9a",onclick:function(){A.close();}});_.addBtn('<a href="/uc/score" target="_blank">\u67e5\u770b\u5151\u6362\u8bb0\u5f55&gt;&gt;</a>');_.addFooter("\u6e29\u99a8\u63d0\u793a\uff1a\u5728\u63d0\u4ea4\u8bcd\u6761\u65f6\u70b9\u51fb\u4f7f\u7528\u5373\u53ef\u3002");var A=new bk.Dialog({titleText:"\u5151\u6362\u6210\u529f",contentText:_.render(),modal:true,buttonbar:false,onload:_.onDialogLoad()});A.open();}};baidu.lang.inherits(bk.shop.DoubleExpByVersion,bk.shop.BaseProps);baidu.more.ns("bk.shop");bk.shop.DialogHelper=function(){this.content=[];this.btn=[];this.footer=[];this.btnHandler=[];};bk.shop.DialogHelper.prototype={tpl:'<div class="bkshopdialog"><div class="content">#{content}</div><div class="btns">#{btns}</div><div class="footer">#{footer}</div></div>',addContent:function(_){this.content.push(_);return this;},addBtn:function(_){if(baidu.isString(_)){this.btn.push(_);return true;}else{if(baidu.isObject(_)){if(_.type=="sinaweibo"){this.btn.push(this.createWeiboButton(_));}else{this.btn.push(this.createButton(_));}}}return this;},addFooter:function(_){this.footer.push(_);return this;},render:function(){var _=this;return baidu.string.format(this.tpl,{content:_.content.join(""),btns:_.btn.join(""),footer:_.footer.join("")});},createButton:function(A){var _=baidu.lang.guid(),B=A.tpl||'<div class="bk-dialog-accept" id="#{id}" onclick="javascript:#{onclick}"><div class="bk-dialog-button-label">#{text}</div></div>',C=A.onclick;if(baidu.lang.isFunction(A.onclick)){C=baidu.fn.bind(C,A.scope);this.addBtnHandler(_,C);C=";";}this.btn.push(baidu.string.format(B,{id:_,onclick:C,text:A.text}));},createWeiboButton:function(C){C=C||{};var _={url:location.href,type:"4",count:"",appkey:"3417820038",title:C.shareText||"",pic:C.sharePic||"",ralateUid:"1647247597",rnd:new Date().valueOf()},B=[];for(var A in _){B.push(A+"="+encodeURIComponent(_[A]||""));}return'<span class="sinaweibo"><a class="tsina" href="javascript:;" onclick="window.open'+"(&quot;http://service.weibo.com/share/share.php?"+B.join("&")+"&quot;,"+"&quot;newwindow&quot;,&quot;height=440,width=430,top=&quot;+(screen.height-440)/2+&quot;,left=&quot;+(screen.width-430)/2+&quot;,"+' toolbar=no, menubar=no, scrollbars=no,resizable=yes,location=no, status=no&quot;);nslog(location.href,3614);return false" '+'title="\u5206\u4eab\u5230\u65b0\u6d6a\u5fae\u535a"></a></span>';},addBtnHandler:function(_,A){this.btnHandler.push({id:_,fn:A});},onDialogLoad:function(){var _=this;return baidu.fn.bind(function(){if(_.btnHandler){baidu.array.each(_.btnHandler,function(_){baidu.on(_.id,"click",function(){_.fn();});});}},_);}};baidu.lang.inherits(bk.shop.DialogHelper,baidu.lang.Class);baidu.more.ns("bk.shop");bk.shop.MyPropsBox=function(_){this.guid=baidu.lang.guid();baidu.extend(this,_);this.parseProps();this.render();};bk.shop.MyPropsBox.prototype={propsCount:0,usedProps:[],unUsedProps:[],renderTo:null,tpl:'<div class="bkshop-propsbox" id="#{id}"><div class="propsbox-header"><span class="icon"></span>\u6211\u7684\u9053\u5177\u7bb1<span class="arrow"></span></div>'+'<div class="propsbox-content"><ul>#{propsList}</ul></div></div>',propTpl:'<li><div class="pic-wrap"><img class="pic" src="#{tinySrc}"/></div><div class="desc"><div class="name">#{name}</div>'+'<div class="props-useinfo" id="propsbox-props#{propsId}">#{useInfo}</div></div></li>',isCollpased:false,collapsed:true,parseProps:function(){var A=this,B,_,C=new bk.shop.ShopManager();baidu.each(["used","unUsed"],function(D){var E=A[D];for(var F in bk.shop.BaseProps.NAMES){B=D+bk.shop.BaseProps.NAMES[F];A[B]=[];}A[D+"Props"]=[];baidu.each(E,function(E){E=C.determineCommodityType(E);E[D]=true;if(E.hasOwnProperty("className")&&E.className&&E.isProps===true){_=E.className;}else{return;}B=D+_;A[B].push(E);A[D+"Props"].push(E);});});this.propsCount=this.usedProps.length+this.unUsedProps.length;},propsUsed:function(C){var A=this.removeProps(C,this.unUsedProps),B=this;if(A){this.addProps(A,this.usedProps);var _=C.className;this.removeProps(A,B["unUsed"+_]);this.addProps(A,B["used"+_]);}},removeProps:function(C,_){if(!C||!_){return;}var A=C.propsId,C=null;for(var D=0,B=_.length;D<B;D++){if(_[D].propsId==A){C=_[D];}}if(C){baidu.array.remove(_,C);}return C;},addProps:function(A,_){_.push(A);},getPropsUseInfo:function(_){var A="";if(_.used===true){if(_.timeLimited===true){_.renderUseInfoTo({id:"propsbox-props"+_.propsId,tpl:'\u5269\u4f59\u65f6\u95f4:<span class="orange">#{leftHour}\u5c0f\u65f6#{leftMinute}\u5206\u949f</span>'});_.countDown(60000);}else{A=_.renderUseInfoTo({tpl:'<span class="orange">\u6b63\u5728\u4f7f\u7528\u4e2d</span>'});}}else{if(_.isBottleProps===true){A="\u5728\u6254\u74f6\u5b50\u65f6\u70b9\u51fb\u4f7f\u7528";}else{A='<span class="btn-use" propsId="'+_.propsId+'" classId="'+_.classId+'">\u4f7f\u7528</span>';}}return A;},render:function(){var _=this;if(!_.renderTo){return;}var A=[];baidu.each(_.usedProps,function(B){B.used=true;B.useInfo=_.getPropsUseInfo(B);A.push(baidu.string.format(_.propTpl,B));});baidu.each(_.unUsedProps,function(B){if(B.isBottleProps){return;}B.used=false;B.useInfo=_.getPropsUseInfo(B);A.push(baidu.string.format(_.propTpl,B));});baidu.dom.insertHTML(_.renderTo,"beforeEnd",baidu.string.format(_.tpl,{id:_.guid,propsList:A.join("")||'<li>\u9053\u5177\u7bb1\u4e2d\u6682\u65f6\u6ca1\u6709\u9053\u5177<br/>\u4f60\u53ef\u4ee5<a href="/mall/zone?zoneId=1" target="_blank" onclick="nslog(location.href,3622);">\u53bb\u767e\u79d1\u5546\u57ce\u5151\u6362</a></li>'}));baidu.each(_.usedProps,function(_){if(_.timeLimited===true){_.countDown(60000);}bk.shop.fillEditField(_);});_.el=baidu.g(_.guid);_.contentEl=baidu.dom.query(".propsbox-content",this.el)[0];_.initEvents();if(_.collapsed===true){_.collapse();}},initEvents:function(){var A=this,B=baidu.dom.query(".propsbox-header",this.el)[0];baidu.on(B,"click",function(){A.toggle();});var _=baidu.dom.query(".btn-use",this.el);baidu.each(_,function(_){baidu.on(_,"click",function(){var D=_.getAttribute("propsId")||0,C=_.getAttribute("classId")||0;if(D&&C){if(C=="3"){nslog(location.href,3620,{t1:1});}else{if(C=="4"){nslog(location.href,3620,{t1:2});}else{if(C=="5"){nslog(location.href,3620,{t1:3});}}}var B=new bk.shop.PropsManager();if(C=="3"||C=="4"){if(A.usedDoubleExpByTime.length>0||A.usedDoubleExpByVersion.length>0){return bk.Dialog.alert("\u4f60\u5df2\u7ecf\u4f7f\u7528\u4e86\u4e00\u5f20\u53cc\u500d\u7ecf\u9a8c\u5361,\u4e0d\u80fd\u540c\u65f6\u4f7f\u7528\u4e24\u5f20\u53cc\u500d\u7ecf\u9a8c\u5361\u54e6~");}}B.addEventListener("propsused",function(B){_.innerHTML="\u4f7f\u7528";var D=B.props;A.propsUsed(D);bk.shop.fillEditField(D);if(D.isCardEditToken===true){g_canInsertCard_flag=true;}if(D.timeLimited===true){D.setLeftTime(12*3600);D.renderUseInfoTo({id:"propsbox-props"+D.propsId,tpl:'\u5269\u4f59\u65f6\u95f4:<span class="orange">#{leftHour}\u5c0f\u65f6#{leftMinute}\u5206\u949f</span>'});D.countDown(60000);}else{D.renderUseInfoTo({id:"propsbox-props"+D.propsId,tpl:'<span class="orange">\u6b63\u5728\u4f7f\u7528\u4e2d</span>'});}var C=baidu.g("bkshopPropsTipsBottom");if(C&&(D.timeLimited||D.doubleExpByVersion)){C.innerHTML="";}});B.addEventListener("propsuseerror",function(){_.innerHTML="\u4f7f\u7528";});_.innerHTML="\u5904\u7406\u4e2d";B.useProps({classId:C,propsId:D,onuse:function(){alert("\u4f7f\u7528\u9053\u5177\u6210\u529f\uff01");}});}});});},toggle:function(){this.isCollpased===true?this.expand():this.collapse();},expand:function(){if(this.isCollpased===false){return;}this.isCollpased=false;baidu.dom.removeClass(this.el,"propsbox-collpased");baidu.dom.setStyle(this.contentEl,"display","");},collapse:function(){if(this.isCollpased===true){return;}this.isCollpased=true;baidu.dom.addClass(this.el,"propsbox-collpased");baidu.dom.setStyle(this.contentEl,"display","none");}};baidu.more.ns("bk.shop");bk.shop=baidu.extend(bk.shop,(function(){function A(B,G){var A,F,H=new bk.shop.ShopManager();B=H.determineCommodityType(B);var _=parseInt(B.price),E=G.activityScore,D=G.wealth,C=false;if(B.consumeType==bk.shop.Commodity.CONSUME_TYPES.SCORE){C=E>=_?true:bk.shop.Commodity.CONSUME_TYPES.SCORE;}else{if(B.consumeType==bk.shop.Commodity.CONSUME_TYPES.WEALTH){C=D>=_?true:bk.shop.Commodity.CONSUME_TYPES.WEALTH;}}if(C!==true){A=new bk.shop.DialogHelper();if(C===bk.shop.Commodity.CONSUME_TYPES.SCORE){A.addContent(">_< \u62b1\u6b49\uff0c\u4f60\u7684\u79ef\u5206\u4e0d\u591f\uff01<br/>");A.addContent('\u5feb\u53bb\u591a\u8d5a\u4e9b\u79ef\u5206\u5427\uff01<a href="/mall#getScore">\u53bb\u8d5a\u5206</a><br/>');}else{if(C===bk.shop.Commodity.CONSUME_TYPES.WEALTH){A.addContent(">_< \u62b1\u6b49\uff0c\u4f60\u7684\u8d22\u5bcc\u503c\u4e0d\u591f\uff01<br/>");A.addContent("\u5feb\u53bb\u591a\u8d5a\u4e9b\u8d22\u5bcc\u503c\u5427\uff01<br/>");}else{A.addContent(">_< \u62b1\u6b49\uff0c\u4f60\u7684\u79ef\u5206\u6216\u8d22\u5bcc\u503c\u4e0d\u591f\uff01<br/>");}}A.addBtn({text:"\u786e\u5b9a",onclick:function(){F.close();}});F=new bk.Dialog({titleText:"\u5151\u6362\u5931\u8d25",contentText:A.render(),modal:true,buttonbar:false,onload:A.onDialogLoad()});F.open();return false;}return true;}function _(C){if(!bkShopUser||bkShopUser.login!==true){userlogin();nslog(location.href,3721,{fr:4});return;}if(bk.pass.checkTofillUsername({nslogType:3725})){return;}var B,E;if(A(C,bkShopUser)!==true){return;}B=new bk.shop.DialogHelper();var _=(C.consumeType==bk.shop.Commodity.CONSUME_TYPES.SCORE?bkShopUser.activityScore:bkShopUser.wealth)||0,D=C.consumeType==bk.shop.Commodity.CONSUME_TYPES.SCORE?"\u79ef\u5206":"\u8d22\u5bcc\u503c";B.addContent("\u672c\u6b21\u5151\u6362\u5c06\u6d88\u8d39"+C.price+D+"\u3002<br/>");B.addContent(baidu.string.format("\u60a8\u5f53\u524d#{unit}#{current}\uff0c\u6d88\u8d39\u540e\u5269\u4f59#{left}\u3002<br/>",{unit:D,current:_,left:_-C.price}));B.addContent("\u786e\u5b9a\u8981\u5151\u6362\u5417\uff1f");B.addBtn({text:"\u786e\u5b9a",onclick:function(){var _=new bk.shop.ShopManager();_.addEventListener("commoditypurchase",function(_){var C=_.commodity;if(C.consumeType==bk.shop.Commodity.CONSUME_TYPES.SCORE){bkShopUser.activityScore-=C.price;var B=baidu.g("bkshop-user-score");if(B){B.innerHTML=bkShopUser.activityScore;}}else{if(C.consumeType==bk.shop.Commodity.CONSUME_TYPES.WEALTH){bkShopUser.wealth-=C.price;var A=baidu.g("bkshop-user-wealth");if(A){A.innerHTML=bkShopUser.wealth;}}}});_.purchase(C);E.close();}});B.addBtn({text:"\u53d6\u6d88",onclick:function(){E.close();}});E=new bk.Dialog({titleText:"\u5151\u6362\u786e\u8ba4",contentText:B.render(),buttonbar:false,onload:B.onDialogLoad()});E.open();}function K(B,A){var _=new bk.shop.PropsManager();_.addEventListener("propsused",function(_){if(baidu.lang.isFunction(A)){A(_);}});_.addEventListener("propsusederror",function(){});_.useProps(B);}function G(){var _=document.createElement("link");_.href="http://baike.bdimg.com/static/usercenter/css/liteoutput/bk.shop.propsbox.css?r="+Math.random();_.type="text/css";_.rel="stylesheet";var A=document.getElementsByTagName("HEAD")[0];A.insertBefore(_,A.firstChild);}function B(B){if(B.className=="DoubleExpByTime"||B.className=="DoubleExpByVersion"||B.className=="CardEditToken"){var A=baidu.g("bkshopPropsId"),_=baidu.g("bkshopPropsClassId");if(A){if(!A.value){A.value=B.propsId;}else{A.value+=(","+B.propsId);}}if(_){if(!_.value){_.value=B.classId;}else{_.value+=(","+B.classId);}}}}function E(_){var A=baidu.g("bkshopViewPropsTips"),B;if(!A){return;}if(_.propsCount===0){A.innerHTML='<a href="/mall/zone?zoneId=1" target="_blank" onclick="nslog(location.href,3618);">\u53bb\u5151\u6362&gt;&gt;</a>'+'<span class="nopropsicon"></span>\u60a8\u5c1a\u65e0\u9053\u5177\u53ef\u4f7f\u7528';}else{if(_.usedDoubleExpByTime.length>0){B=_.usedDoubleExpByTime[0];B.renderUseInfoTo({id:"bkshopViewPropsTips",tpl:'<span class="propsicon"></span>\u53cc\u500d\u79ef\u5206\u5269\u4f59\u65f6\u95f4\uff1a<span class="num">#{leftHour}:#{leftMinute}:#{leftSecond}<span>'});B.countDown(1000);}else{if(_.unUsedProps.length>0){if(_.unUsedDoubleExpByTime.length>0){B=_.unUsedDoubleExpByTime[0];}else{if(_.unUsedDoubleExpByVersion.length>0){B=_.unUsedDoubleExpByVersion[0];}else{if(_.unUsedCardEditToken.length>0){B=_.unUsedCardEditToken[0];}else{if(_.unUsedBottleProps.length>0){B=_.unUsedBottleProps[0];}}}}if(B){A.innerHTML='<a href="/uc/prop" target="_blank" onclick="nslog(location.href,3619);">\u53bb\u4f7f\u7528&gt;&gt;</a>'+'<span class="propsicon"></span>\u53ef\u7528\u9053\u5177\uff1a<span class="num">'+B.name+"</span>";}}}}}function C(_){var A=baidu.g("bkshopPropsTipsBottom"),B;if(!A){return;}if(_.usedDoubleExpByTime.length==0&&(_.unUsedDoubleExpByTime.length>0||_.unUsedDoubleExpByVersion.length>0)){A.innerHTML='<span style="margin-left:10px;font-size:12px;color:#f70;">\u60a8\u7684\u9053\u5177\u7bb1\u4e2d\u8fd8\u6709\u53cc\u500d\u7ecf\u9a8c\u5361\uff0c\u63d0\u4ea4\u524d\u53ef\u4ee5\u5728\u9053\u5177\u7bb1\u4e2d\u70b9\u51fb\u4f7f\u7528</span>';}}function L(){var _=new bk.shop.PropsManager(),A;_.addEventListener("propslist",function(_){var B=_.props;if(baidu.g("bkshopItemTips")){B.renderTo=document.body;B.collapsed=false;G();}A=new bk.shop.MyPropsBox(B);E(A);C(A);bk.shop.propsBox=A;});_.listProps();}function D(){if(window.location.hash=="#exchange"){var _=baidu.g("bkshop-exchange-btn");if(_&&_.onclick){_.onclick.call(_);}else{var A="\u4e0d\u80fd\u5151\u6362\u8be5\u5546\u54c1!";if(baidu.dom.query(".commodityinfo .btns .finish").length>0){A="\u5f88\u62b1\u6b49,\u5151\u6362\u5df2\u7ed3\u675f\uff01>_<";}else{if(baidu.dom.query(".commodityinfo .btns .purchase-disable").length>0){A="\u5f88\u62b1\u6b49,\u4e0d\u6ee1\u8db3\u5151\u6362\u6761\u4ef6\uff01>_<";}}bk.Dialog.alert(A,{titleText:"\u5151\u6362\u5931\u8d25"});}window.location.hash="";}}function H(_){B(_.props);}function F(_){return _;}function J(_){_=parseInt(_);if(!_){return"";}var B=parseInt(_/24),C="",A="\u5c0f\u65f6";if(B>0){A="\u5929";}else{B=_;}if(B==2){C="\u4e24";}else{if(B>=3){C=String(B);}}return C+A;}function I(){if(bk.shop.propsBox&&typeof bk.shop.propsBox.collapse=="function"){bk.shop.propsBox.collapse();}}return{doExchange:_,listMyProps:L,useProps:K,autoExchange:D,cardEditTokenUsedInEditCallback:H,replace:F,hourToDay:J,fillEditField:B,collapsePropsBox:I};}()));baidu.dom.ready(function(){setTimeout(bk.shop.autoExchange,500);});bk.shop.ShopManager=function(){};bk.shop.ShopManager.prototype={purchase:function(_){if(!_||!_.classId||!_.id){throw new bk.shop.BusinessError("\u5546\u54c1\u4fe1\u606f\u4e0d\u6b63\u786e\u3002");}var A=this;_=this.determineCommodityType(_);_.addEventListener("purchase",function(_){A.dispatchEvent("commoditypurchase",{commodity:_.commodity});});_.addEventListener("purchaseerror",function(_){A.dispatchEvent("purchaseerror",{commodity:_.commodity,err:_.err});});_.purchase();},determineCommodityType:function(_){_=_||{};if(!_.hasOwnProperty("classId")){return;}if(_ instanceof bk.shop.Commodity){return _;}var A=this.getClassNameById(_.classId);if(A=="UNKOWN"||typeof bk.shop[A]=="undefined"){throw new bk.shop.BusinessError("\u672a\u77e5\u7684\u5546\u54c1\u7c7b\u522b\u3002");}_.className=A;return new bk.shop[A](_);},getClassNameById:function(_){var A=bk.shop.Commodity.TYPE;return A[_]||"UNKOWN";}};baidu.lang.inherits(bk.shop.ShopManager,baidu.lang.Class);bk.shop.PropsManager=function(){this.initEvents();};bk.shop.PropsManager.prototype={USE_URL:"/user/useprops?",LIST_URL:"/api/user/getuserprops?act=1",initEvents:function(){var _=this;baidu.on(_,"commoditypurchase",function(A){var B=A.commodity;if(B.isProps){_.dispatchEvent("propspurchase",{props:B});}});},purchase:function(){bk.shop.PropsManager.superClass.purchase.apply(this,arguments);},useProps:function(B){B=this.determineCommodityType(B);if(B.isProps!==true){throw new bk.shop.BusinessError("\u8be5\u5546\u54c1\u4e0d\u662f\u9053\u5177\uff0c\u4e0d\u80fd\u88ab\u4f7f\u7528\uff01");}var _=this,A={id:B.propsId,classId:B.classId};if(B.onbeforeuse()!==false){baidu.ajax.post(_.USE_URL,baidu.url.jsonToQuery(A),function(C){var A=baidu.json.parse(C.responseText);if(A.success){B.used=true;_.dispatchEvent("propsused",{props:B});B.onuse.call(B);}else{_.dispatchEvent("propsuseerror",{props:B,err:new bk.shop.BusinessError(A)});B.onuseerr.call(B,new bk.shop.BusinessError(A));}});}},listProps:function(){var _=this,A={};baidu.ajax.post(_.LIST_URL,baidu.url.jsonToQuery(A),function(B){var A=baidu.json.parse(B.responseText);if(A.success){baidu.each(A.using||[],function(_){_.id=_.itemId;_.name=_.itemName;});baidu.each(A.unused||[],function(_){_.id=_.itemId;_.name=_.itemName;});var C={used:A.using||[],unUsed:A.unused||[]};_.dispatchEvent("propslist",{props:C});}});}};baidu.lang.inherits(bk.shop.PropsManager,bk.shop.ShopManager,"bk.shop.PropsManager");